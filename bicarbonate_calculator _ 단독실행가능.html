<div style="max-width: 800px; margin: auto; font-family: sans-serif;">
  <h2 style="text-align: center; margin-bottom: 16px;">중탄산 CRI 계산기</h2>

  <div style="border: 1px solid #ccc; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
    <h3 style="margin-top: 0;">⚙️ 기본 정보</h3>
    <label>체중 (kg): <input type="number" id="weightInput" step="0.1"></label>
    <br><br>
    <label>현재 중탄산 수치 (HCO₃⁻, mEq/L): <input type="number" id="bicarbInput" step="0.1"></label>
  </div>

  <div style="border: 1px solid #ccc; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
    <h3 style="margin-top: 0;">🧮 계산 수식</h3>
    <p style="font-size: 1.1em; background: #f9f9f9; padding: 12px; border-radius: 6px;">
      \[
      \text{필요 보정량 (mEq)} = (24 - \text{HCO₃⁻}) \times \text{체중 (kg)} \times \text{분포계수}
      \]
      <span style="color: #555; font-size: 0.9em;">※ 분포계수 기본값: 0.4</span>
    </p>
    <p id="correctionDisplay" style="font-weight: bold; color: #333; font-size: 1.05em; margin-top: 12px;"></p>
  </div>

  <div style="border: 1px solid #ccc; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
    <h3 style="margin-top: 0;">⚙️ 분포계수 조정</h3>
    <input type="range" id="distribution" min="0.3" max="0.6" step="0.1" value="0.4" style="width: 100%;">
    <div style="display: flex; justify-content: space-between; font-size: 0.9em; color: #666;">
      <span>0.3</span><span>0.4</span><span>0.5</span><span>0.6</span>
    </div>
    <p>현재 분포계수: <span id="distributionValue">0.4</span></p>
  </div>

  <div style="border: 1px solid #ccc; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
    <h3 style="margin-top: 0;">🧪 CRI 계획 (선택 사항)</h3>
    <label>총 투여 시간 (시간):
      <input type="range" id="infusionTime" min="1" max="12" value="6" step="1" style="width: 100%;">
    </label>
    <div style="display: flex; justify-content: space-between; font-size: 0.9em; color: #666;">
      <span>1</span><span>3</span><span>6</span><span>9</span><span>12</span>
    </div>
    <p>선택한 투여 시간: <span id="timeDisplay">6</span>시간</p>

    <label>수액 속도 (mL/hr): <input type="number" id="fluidRate" step="1"></label>

    <div id="fluidSummary" style="margin-top: 12px; background: #e9f5ff; padding: 10px; border-radius: 5px; font-size: 0.95em;"></div>

    <div id="warningBox" style="display: none; margin-top: 12px; background: #fff4e5; padding: 10px; border-radius: 5px; font-size: 0.95em;">
      ⚠️ <strong>주의:</strong> 중탄산 용량이 총 수액량을 초과할 수 없습니다. 입력값을 확인하세요.
    </div>
  </div>

  <div style="border: 1px solid #ccc; border-radius: 8px; padding: 16px;">
    <h3 style="margin-top: 0;">📋 주의사항</h3>
    <ul style="margin: 0; padding-left: 20px;">
      <li>중탄산은 혼합 금지 약물이 많아 되도록 별도 라인 사용 권장</li>
      <li style="list-style: none; margin-left: 1em;">(대표적으로 칼슘제제, 마그네슘, 도파민, 노르에피네프린·도부타민, 아드레날린, 아미노필린, 여러 항생제 등)</li>
      <li>빛에 노출되면 안정성이 떨어질 수 있으므로 가급적 차광</li>
      <li>혈중 pH와 이온 상태에 따라 실제 보정량의 효과가 달라질 수 있음</li>
      <li>급속 보정 시 알칼리증 및 저칼륨혈증 위험 존재</li>
      <li>기저 질환, 전해질 상태, 이뇨제 병용 여부 등을 고려하여 신중히 투여</li>
    </ul>
  </div>
</div>

<script>
  const distSlider = document.getElementById('distribution');
  const distValue = document.getElementById('distributionValue');
  const correctionDisplay = document.getElementById('correctionDisplay');
  distSlider.addEventListener('input', function() {
    distValue.textContent = this.value;
    updateFluidSummary();
  });

  const timeSlider = document.getElementById('infusionTime');
  const timeDisplay = document.getElementById('timeDisplay');
  timeSlider.addEventListener('input', function() {
    timeDisplay.textContent = this.value;
    updateFluidSummary();
  });

  const fluidRate = document.getElementById('fluidRate');
  fluidRate.addEventListener('input', updateFluidSummary);

  const weightInput = document.getElementById('weightInput');
  const bicarbInput = document.getElementById('bicarbInput');
  weightInput.addEventListener('input', updateFluidSummary);
  bicarbInput.addEventListener('input', updateFluidSummary);

  function updateFluidSummary() {
    const rate = parseFloat(fluidRate.value);
    const time = parseFloat(timeSlider.value);
    const hco3 = parseFloat(bicarbInput.value);
    const weight = parseFloat(weightInput.value);
    const dist = parseFloat(distSlider.value);
    const warningBox = document.getElementById('warningBox');

    if (!isNaN(hco3) && !isNaN(weight) && !isNaN(dist)) {
      const correction = (24 - hco3) * weight * dist;
      const volume84 = correction * 1;
      correctionDisplay.textContent = `필요 보정량: ${correction.toFixed(1)} mEq (= ${volume84.toFixed(1)} mL, 8.4% 중탄산나트륨제 기준)`;
    } else {
      correctionDisplay.textContent = '';
    }

    if (isNaN(rate) || isNaN(time) || isNaN(hco3) || isNaN(weight)) {
      warningBox.style.display = 'none';
      return;
    }

    const correction = (24 - hco3) * weight * dist;
    const bicarbVolume = correction * 1;
    const totalVolume = rate * time;
    const baseVolume = totalVolume - bicarbVolume;

    if (baseVolume < 0) {
      warningBox.style.display = 'block';
      return;
    } else {
      warningBox.style.display = 'none';
    }

    const summaryBox = document.getElementById('fluidSummary');
    summaryBox.innerHTML = `
      ➕ <strong>${bicarbVolume.toFixed(1)}mL</strong>의 중탄산을 포함하여 총 <strong>${totalVolume.toFixed(0)}mL</strong> CRI 용액을 준비해주세요.<br>
      👉 희석에 필요한 베이스 수액은 <strong>${baseVolume.toFixed(1)}mL</strong>입니다.`;
  }
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
